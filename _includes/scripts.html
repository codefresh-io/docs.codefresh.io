<script>
  const SITE_BASE_URL = "{{ site.baseurl }}";
  const SITE_GITOPS_COLLECTION = "{{ site.gitops_collection }}";
  const SITE_IS_GITOPS_COLLECTION = "{{ page.collection }}" === "{{ site.gitops_collection }}";
</script>
<script src="{{ site.baseurl }}/assets/js/argohub-redirect/argohub-redirect.min.js"></script>


<script src="{{ site.cdn.jquery }}" integrity="{{ site.cdn.jquery_hash }}" crossorigin="anonymous"></script>
<script>window.jQuery || document.write('<script src="{{ site.baseurl }}/assets/js/vendor/jquery.min.js"><\/script>')</script>

<script src="{{ site.baseurl }}/assets/js/vendor/popper.min.js"{% if site.github %} integrity="{{ site.cdn.popper_hash }}" crossorigin="anonymous"{% endif %}></script>

{%- if site.github -%}
  <script src="{{ site.cdn.js }}" integrity="{{ site.cdn.js_hash }}" crossorigin="anonymous"></script>
{%- else -%}
  <script src="{{ site.baseurl }}/dist/js/bootstrap.js"></script>
{%- endif -%}

{%- if page.layout == "docs" -%} {%- endif -%}
<script src="https://cdn.jsdelivr.net/npm/typesense-docsearch.js@3.0.1"></script>
<!-- <script src="https://cdn.jsdelivr.net/npm/typesense-docsearch.js@latest/dist/cdn/docsearch.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script> -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.min.js"></script>

{%- if site.github -%}
  <script src="{{ site.baseurl }}/assets/js/docs.min.js"></script>
{%- else -%}
  <script src="{{ site.baseurl }}/assets/js/vendor/anchor.min.js"></script>
  <script src="{{ site.baseurl }}/assets/js/vendor/clipboard.min.js"></script>
  <script src="{{ site.baseurl }}/assets/js/vendor/holder.min.js"></script>
  <script src="{{ site.baseurl }}/assets/js/vendor/jquery.smooth-scroll.min.js"></script>

  <script src="{{ site.baseurl }}/assets/js/vendor/jquery.cookie.min.js"></script>
  <script src="{{ site.baseurl }}/assets/js/vendor/jquery.navgoco.js"></script>

  <script src="{{ site.baseurl }}/assets/js/src/application.js"></script>
  <script src="{{ site.baseurl }}/assets/js/src/ie-emulation-modes-warning.js"></script>
  <script src="{{ site.baseurl }}/assets/js/src/redirect-popup.js"></script>
{%- endif -%}


<!-- Start of Doc Search Embed Code -->
<!--<script>-->
<!--  docsearch({-->
<!--    // inputSelector: '.doc-search-input',-->
<!--    container: '#searchbar',-->
<!--    typesenseCollectionName: 'project-one-doc-index', // Should match the collection name you mention in the docsearch scraper config.js-->
<!--    typesenseServerConfig: {-->
<!--      nodes: [{-->
<!--        host: 'fxokw93dqyu27pv6p.a1.typesense.net', // For Typesense Cloud use xxx.a1.typesense.net-->
<!--        port: '443',      // For Typesense Cloud use 443-->
<!--        protocol: 'https'   // For Typesense Cloud use https-->
<!--      }],-->
<!--      apiKey: '5aRIuEbEpw9LTf2B5te4Essx4o4HE4Fl', // Use API Key with only Search permissions-->
<!--    },-->
<!--  });-->
<!--</script>-->
<!-- End of Doc Search Embed Code -->

<script>
  // Initialize Amplitude Analytics + Guides & Surveys (Resource Center)
  (function() {
    const API_KEY = '42885a887590b9e28cce52518224850b';

    // Load and initialize Amplitude Analytics first
    function loadAnalyticsSDK() {
      const script = document.createElement('script');
      script.src = `https://cdn.amplitude.com/script/${API_KEY}.js`;
      script.onload = onAnalyticsLoaded;
      script.onerror = () => console.error('Failed to load Amplitude Analytics');
      document.head.appendChild(script);
    }

    function onAnalyticsLoaded() {
      if (typeof window.amplitude === 'undefined') {
        console.warn('Amplitude Analytics not available');
        return;
      }

      window.amplitude.init(API_KEY, {
        autocapture: false,
      });

      setContentSegmentation();
      loadEngagementSDK();
    }

    // Load and initialize Guides & Surveys SDK
    function loadEngagementSDK() {
      const script = document.createElement('script');
      script.src = `https://cdn.amplitude.com/script/${API_KEY}.engagement.js`;
      script.onload = onEngagementLoaded;
      script.onerror = () => console.error('Failed to load Amplitude Engagement');
      document.head.appendChild(script);
    }

    function onEngagementLoaded() {
      if (typeof window.engagement === 'undefined') {
        console.warn('Amplitude Engagement not available');
        return;
      }

      window.amplitude.add(window.engagement.plugin());
      setupResourceCenterShortcut();
    }

    function setupResourceCenterShortcut() {
      document.addEventListener('keydown', function(event) {
        const isMac = navigator.userAgent.includes('Mac');
        const isShortcut = (event.key === 'k') &&
          ((isMac && event.metaKey) || (!isMac && event.ctrlKey));

        if (isShortcut) {
          event.preventDefault();
          window.engagement.rc.open();
        }
      });
    }

    // Set content segment based on system type
    function setContentSegmentation() {
      const identify = new window.amplitude.Identify();
      const segment = IS_GITOPS_DOC_COOKIE_SET ? 'gitOpsCloud' : 'enterprise';
      identify.set('segment', segment);
      window.amplitude.identify(identify);
    }

    loadAnalyticsSDK();
  })();
</script>
