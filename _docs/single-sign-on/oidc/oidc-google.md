---
title: "Google"
description: "Setting Up Google IDP Single Sign-On (SSO)"
group: single-sign-on
sub_group: oidc
toc: true
---

In this page we will see the process of setting up Google IDP with Codefresh. For the general instructions of SSO setup
see the [overview page]({{site.baseurl}}/docs/administration/single-sign-on/sso-setup-oauth2/).

## Create Client Secret

Log in [https://console.developers.google.com/](https://console.developers.google.com/) and select *Credentials* on the left sidebar. Click the *Create Credentials* button and choose *OAuth client ID* from the drop down menu.

In the next screen select *Web application* as the *Application type*. Enter a name for your integration (user-defined). Add as URI `https://g.codefresh.io` in the *Authorized JavaScript origins* section.

{% include image.html
lightbox="true"
file="/images/administration/sso/google/googleSSO.png"
url="/images/administration/sso/google/googleSSO.png"
alt="Creating an OAuth client"
caption="Creating an OAuth client"
max-width="80%"
%}

Click the *Create* button. You will see a dialog with the client Id and secret values. Note down both of these values.

{% include image.html
lightbox="true"
file="/images/administration/sso/google/googleSSO2.png"
url="/images/administration/sso/google/googleSSO2.png"
alt="Getting the Client ID and secret"
caption="Getting the Client ID and secret"
max-width="80%"
%}

You will need the Client ID and secret in the Codefresh configuration screen.

## Enter details on the Codefresh side

Go back into Codefresh and choose Google at the [SSO Settings](https://g.codefresh.io/account-admin/sso)

{% include image.html
lightbox="true"
file="/images/administration/sso/google/google-idp-integration.png"
url="/images/administration/sso/google/google-idp-integration.png"
alt="Choosing Google for Auth"
caption="Choosing Google for Auth"
max-width="20%"
%}

In the configuration screen fill in the following:

* `DISPLAY NAME` - Friendly SSO name (arbitrary)
* `CLIENT ID` - Use the value you got from the previous section
* `CLIENT SECRET` - Use the value you got from the previous section

{% include image.html
lightbox="true"
file="/images/administration/sso/google/codefresh-settings.png"
url="/images/administration/sso/google/codefresh-settings.png"
alt="Entering Codefresh Settings"
caption="Entering Codefresh Settings"
max-width="90%"
%}

After clicking SAVE youâ€™ll see the generated Client Name:

{% include image.html
lightbox="true"
file="/images/administration/sso/google/autogenerated-name.png"
url="/images/administration/sso/google/autogenerated-name.png"
alt="Getting the auto-generated Client Name"
caption="Getting the auto-generated Client Name"
max-width="90%"
%}

Note this down as you will use it in the Google Console.

## Setup Redirect URI

Go back to the Google Console Developer dashboard and click the edit button on the OAuth 2.0 Client IDs that you created before.

Use the Client Name from the previous section to generate the *Authorized Redirect URIs*

* Example Client Name: `t0nlUJoqQlDv`
* Example Redirect URI: `https://g.codefresh.io/api/auth/t0nlUJoqQlDv/callback`

{% include image.html
lightbox="true"
file="/images/administration/sso/google/googleSSO3.png"
url="/images/administration/sso/google/googleSSO3.png"
alt="Redirect URI"
caption="Redirect URI"
max-width="90%"
%}

This concludes the basic SSO setup for Google. For team/group synchronization you also need a service account.

## Synchronize teams with the Codefresh CLI

In the Codefresh configuration screen there are some optional fields that you can fill, to configure team synchronization via the Codefresh CLI.  

You can do one of the following:  

* Sync *all users and groups*, by creating a service account and [delegating user and group permissions](https://developers.google.com/admin-sdk/directory/v1/guides/delegation) to it.
* Sync *only users who have been assigned the custom schema*, by creating a custom schema for user accounts, and creating and assigning the user role.

### Sync all users with service account from Google Console

Use this method to sync all users.

{% include image.html
lightbox="true"
file="/images/administration/sso/google/serviceAccount2.png"
url="/images/administration/sso/google/serviceAccount2.png"
alt="Creating a service account"
caption="Creating a service account"
max-width="90%"
%}

Delegate from the Google admin console the following permissions:

* `https://www.googleapis.com/auth/admin.directory.user.readonly`
* `https://www.googleapis.com/auth/admin.directory.group.readonly`

For that service account you should also create a private key in JSON format.

{% include image.html
lightbox="true"
file="/images/administration/sso/google/serviceAccount3.png"
url="/images/administration/sso/google/serviceAccount3.png"
alt="Creating a JSON key"
caption="Creating a JSON key"
max-width="90%"
%}

Save the file locally. Go back to the Codefresh settings and fill in the fields

* `JSON Keyfile` - enter contents of the JSON file
* `Admin email` -  The user that has access to `admin.google.com`

### Sync users by assigning custom schema to user accounts

Use this method to sync only those users who have been assigned the user role with the custom schema.

1. Navigate to the [Google Directory API](https://developers.google.com/admin-sdk/directory/v1/reference/schemas/insert?authuser=1).
1. Add the following schema:

    ```json
    {  
      "schemaName": "SSO",  
      "displayName": "SSO",  
      "fields": [  
        {  
          "fieldType": "STRING",  
          "fieldName": "UserRole",  
          "displayName": "UserRole",  
          "multiValued": true,  
          "readAccessType": "ADMINS_AND_SELF"  
        }  
     ]
    }
    ```

1. In the GSuite Admin panel, go to `Apps > SAML`.

    {% include image.html
    lightbox="true"
    file="/images/administration/sso/google/google-gsuite-admin.png"
    url="/images/administration/sso/google/google-gsuite-admin.png"
    alt="SAML apps in GSuite Admin panel"
    caption="SAML apps in GSuite Admin panel"
    max-width="40%"
    %}

1. Expand the Attribute Mapping settings, and add a Role attribute with the above schema for `SSO` and `UserRole`.
1. For every user to be synced, in the User Information screen, scroll to `SSO > UserRole`, and assign the user role.

  {% include image.html
lightbox="true"
file="/images/administration/sso/google/google-gusite-user-info.png"
url="/images/administration/sso/google/google-gusite-user-info.png"
alt="User Information screen in GSuite"
caption="User Information screen in GSuite"
max-width="40%"
%}

### Configure sync setting in Codefresh SAML

This is required only if you are syncing users via a custom schema.

1. In the Codefresh UI, open the SAML configuration screen.
1. In the `Sync` field, set the value to the custom schemaName.

{% include image.html
lightbox="true"
file="/images/administration/sso/google/google-cf-saml-setting.png"
url="/images/administration/sso/google/google-cf-saml-setting.png"
alt="SAML Sync Setting in Codefresh for Google GSuite"
caption="SAML Sync Setting in Codefresh for Google GSuite"
max-width="40%"
%}

Now you can [synchronize teams with the Codefresh CLI]({{site.baseurl}}/docs/administration/single-sign-on/sso-setup-oauth2/#syncing-of-teams-after-initial-sso-setup) .

## What to read next

See the [overview page]({{site.baseurl}}/docs/administration/single-sign-on/sso-setup-oauth2/#testing-your-identity-provider) on how to test the integration, activate SSO for collaborators and create sync jobs.
